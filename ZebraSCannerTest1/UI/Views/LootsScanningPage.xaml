<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ZebraSCannerTest1.UI.Views.LootsScanningPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="clr-namespace:ZebraSCannerTest1.UI.Converters"
    xmlns:viewmodels="clr-namespace:ZebraSCannerTest1.UI.ViewModels"
    mc:Ignorable="d"
    Title="Loots Scanning">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:DifferenceToColorConverter x:Key="DiffToColor" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <VerticalStackLayout Padding="0" Spacing="12">

        <HorizontalStackLayout Spacing="8" Padding="3" HorizontalOptions="CenterAndExpand">
            <Button Text="Stats" Command="{Binding GoToScannedProductsCommand}" />
            <Button Text="Logs" Command="{Binding GoToLogsCommand}" />
            <Button Text="Rslt" Command="{Binding ShowResultsCommand}" />
        </HorizontalStackLayout>

            <Label Text="{Binding CurrentBoxId, StringFormat='Box: {0}'}"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                   HorizontalTextAlignment="Center" />

        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto" Padding="10,0">
            <Entry x:Name="lootBarcodeEntry"
                   Grid.Column="0"
                   Placeholder="Scan barcode..."
                   ReturnType="Done"
                   ClearButtonVisibility="WhileEditing"
                   Text="{Binding CurrentBarcode}" 
                   TextColor="{AppThemeBinding Light=Black, Dark=White}" 
                   Completed="OnBarcodeCompleted"/>
        </Grid>

        <!-- Header -->
        <Grid ColumnDefinitions="2*,*,*,*" RowDefinitions="Auto" Padding="6,4">
            <Label Text="Barcode" TextColor="{AppThemeBinding Light=Black, Dark=White}" FontAttributes="Bold" />
            <Label Text="Scanned" Grid.Column="1" HorizontalTextAlignment="Center" TextColor="{AppThemeBinding Light=Black, Dark=White}" FontAttributes="Bold" />
            <Label Text="Initial" Grid.Column="2" TextColor="{AppThemeBinding Light=Black, Dark=White}" HorizontalTextAlignment="End" FontAttributes="Bold" />
            <Label Text="Diff" Grid.Column="3" TextColor="{AppThemeBinding Light=Black, Dark=White}" HorizontalTextAlignment="End" FontAttributes="Bold" />
        </Grid>

        <!-- 8 STATIC SLOTS -->
        <Grid ColumnDefinitions="2*,*,*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" Padding="6" RowSpacing="6">
            <Grid.Resources>
                <Style TargetType="Label">
                    <Setter Property="FontSize" Value="16" />
                    <Setter Property="TextColor" Value="{AppThemeBinding Light=Black, Dark=White}" />
                </Style>
            </Grid.Resources>

            <!-- Row 0 -->
            <Grid Grid.Row="0" Grid.ColumnSpan="4" ColumnDefinitions="2*,*,*,*" Padding="5" BackgroundColor="{Binding Slots[0].Difference, Converter={StaticResource DiffToColor}}">
                <Label Grid.Column="0" Text="{Binding Slots[0].Barcode}" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                <Label Grid.Column="1" Text="{Binding Slots[0].ScannedQuantity}" HorizontalTextAlignment="Center" TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                <Label Grid.Column="2" Text="{Binding Slots[0].InitialQuantity}" HorizontalTextAlignment="End" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                <Label Grid.Column="3" Text="{Binding Slots[0].Difference}" HorizontalTextAlignment="End" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToDetailsCommand}" CommandParameter="{Binding Slots[0]}" />
                </Grid.GestureRecognizers>
            </Grid>

            <!-- Row 1 -->
            <Grid Grid.Row="1" Padding="5" Grid.ColumnSpan="4" ColumnDefinitions="2*,*,*,*" BackgroundColor="{Binding Slots[1].Difference, Converter={StaticResource DiffToColor}}">
                <Label Grid.Column="0" Text="{Binding Slots[1].Barcode}" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                <Label Grid.Column="1" Text="{Binding Slots[1].ScannedQuantity}" HorizontalTextAlignment="Center" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                <Label Grid.Column="2" Text="{Binding Slots[1].InitialQuantity}" HorizontalTextAlignment="End" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                <Label Grid.Column="3" Text="{Binding Slots[1].Difference}" HorizontalTextAlignment="End" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToDetailsCommand}" CommandParameter="{Binding Slots[1]}" />
                </Grid.GestureRecognizers>
            </Grid>

            <!-- Row 2 -->
            <Grid Grid.Row="2" Padding="5" Grid.ColumnSpan="4" ColumnDefinitions="2*,*,*,*" BackgroundColor="{Binding Slots[2].Difference, Converter={StaticResource DiffToColor}}">
                <Label Grid.Column="0" Text="{Binding Slots[2].Barcode}" />
                <Label Grid.Column="1" Text="{Binding Slots[2].ScannedQuantity}" HorizontalTextAlignment="Center" />
                <Label Grid.Column="2" Text="{Binding Slots[2].InitialQuantity}" HorizontalTextAlignment="End" />
                <Label Grid.Column="3" Text="{Binding Slots[2].Difference}" HorizontalTextAlignment="End" />
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToDetailsCommand}" CommandParameter="{Binding Slots[2]}" />
                </Grid.GestureRecognizers>
            </Grid>

            <!-- Row 3 -->
            <Grid Grid.Row="3" Padding="5" Grid.ColumnSpan="4" ColumnDefinitions="2*,*,*,*" BackgroundColor="{Binding Slots[3].Difference, Converter={StaticResource DiffToColor}}">
                <Label Grid.Column="0" Text="{Binding Slots[3].Barcode}" />
                <Label Grid.Column="1" Text="{Binding Slots[3].ScannedQuantity}" HorizontalTextAlignment="Center" />
                <Label Grid.Column="2" Text="{Binding Slots[3].InitialQuantity}" HorizontalTextAlignment="End" />
                <Label Grid.Column="3" Text="{Binding Slots[3].Difference}" HorizontalTextAlignment="End" />
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToDetailsCommand}" CommandParameter="{Binding Slots[3]}" />
                </Grid.GestureRecognizers>
            </Grid>

            <!-- Row 4 -->
            <Grid Grid.Row="4" Padding="5" Grid.ColumnSpan="4" ColumnDefinitions="2*,*,*,*" BackgroundColor="{Binding Slots[4].Difference, Converter={StaticResource DiffToColor}}">
                <Label Grid.Column="0" Text="{Binding Slots[4].Barcode}" />
                <Label Grid.Column="1" Text="{Binding Slots[4].ScannedQuantity}" HorizontalTextAlignment="Center" />
                <Label Grid.Column="2" Text="{Binding Slots[4].InitialQuantity}" HorizontalTextAlignment="End" />
                <Label Grid.Column="3" Text="{Binding Slots[4].Difference}" HorizontalTextAlignment="End" />
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToDetailsCommand}" CommandParameter="{Binding Slots[4]}" />
                </Grid.GestureRecognizers>
            </Grid>


            <!-- Row 5 -->
            <Grid Grid.Row="5" Padding="5" Grid.ColumnSpan="4" ColumnDefinitions="2*,*,*,*" BackgroundColor="{Binding Slots[5].Difference, Converter={StaticResource DiffToColor}}">
                <Label Grid.Column="0" Text="{Binding Slots[5].Barcode}" />
                <Label Grid.Column="1" Text="{Binding Slots[5].ScannedQuantity}" HorizontalTextAlignment="Center" />
                <Label Grid.Column="2" Text="{Binding Slots[5].InitialQuantity}" HorizontalTextAlignment="End" />
                <Label Grid.Column="3" Text="{Binding Slots[5].Difference}" HorizontalTextAlignment="End" />
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToDetailsCommand}" CommandParameter="{Binding Slots[5]}" />
                </Grid.GestureRecognizers>
            </Grid>

            <!-- Row 6 -->
            <Grid Grid.Row="6" Grid.ColumnSpan="4" ColumnDefinitions="2*,*,*,*" Padding="5" BackgroundColor="{Binding Slots[6].Difference, Converter={StaticResource DiffToColor}}">
                <Label Grid.Column="0" Text="{Binding Slots[6].Barcode}" />
                <Label Grid.Column="1" Text="{Binding Slots[6].ScannedQuantity}" HorizontalTextAlignment="Center" />
                <Label Grid.Column="2" Text="{Binding Slots[6].InitialQuantity}" HorizontalTextAlignment="End" />
                <Label Grid.Column="3" Text="{Binding Slots[6].Difference}" HorizontalTextAlignment="End" />
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToDetailsCommand}" CommandParameter="{Binding Slots[6]}" />
                </Grid.GestureRecognizers>
            </Grid>

            <!-- Row 7 -->
            <Grid Grid.Row="7" Grid.ColumnSpan="4" ColumnDefinitions="2*,*,*,*" Padding="5" BackgroundColor="{Binding Slots[7].Difference, Converter={StaticResource DiffToColor}}">
                <Label Grid.Column="0" Text="{Binding Slots[7].Barcode}" />
                <Label Grid.Column="1" Text="{Binding Slots[7].ScannedQuantity}" HorizontalTextAlignment="Center" />
                <Label Grid.Column="2" Text="{Binding Slots[7].InitialQuantity}" HorizontalTextAlignment="End" />
                <Label Grid.Column="3" Text="{Binding Slots[7].Difference}" HorizontalTextAlignment="End" />
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToDetailsCommand}" CommandParameter="{Binding Slots[7]}" />
                </Grid.GestureRecognizers>
            </Grid>
        </Grid>


    </VerticalStackLayout>
</ContentPage>
